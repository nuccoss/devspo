# MSI内蔵キーボード Left Ctrl無効化 - トラブルシューティングガイド

## 🔧 問題と解決策

### 1. スクリプトが起動しない
**症状**: ダブルクリックしても何も起こらない
**原因**: AutoHotkey v2がインストールされていない
**解決策**: 
1. [AutoHotkey v2公式サイト](https://www.autohotkey.com/)からダウンロード
2. インストール後、スクリプトを再実行

### 2. 「管理者権限が必要」エラー
**症状**: 権限エラーが表示される
**解決策**: 
1. スクリプトファイルを右クリック
2. 「管理者として実行」を選択
3. またはAutoHotkeyを管理者として起動

### 3. Left Ctrlがまだ有効
**症状**: 内蔵キーボードのLeft Ctrlが無効化されない
**考えられる原因**:
- デバイスハンドル文字列の相違
- スキャンコードの相違

**診断手順**:
1. **VS Code ターミナル**で以下を実行してDebugViewを確認:
```powershell
# DebugViewダウンロード（Microsoft公式ツール）
# https://docs.microsoft.com/en-us/sysinternals/downloads/debugview
```

2. DebugViewでスクリプトのログを確認
3. 実際のデバイス名・スキャンコードを確認

### 4. 外部キーボードも影響を受ける
**症状**: Bluetoothキーボード等のCtrlも無効になる
**原因**: デバイス識別が正しく動作していない
**解決策**: スクリプト内の `targetDeviceHandle` 変数を調整

### 5. システム全体が不安定
**症状**: 他のアプリケーションに影響
**緊急対処**:
1. **タスクマネージャー**（Ctrl+Shift+Esc）を開く
2. 「プロセス」タブで「AutoHotkey」を探す
3. 右クリック→「タスクの終了」

## 🚀 高度な設定

### カスタマイズオプション

#### 1. 他のキーも無効化したい場合
```autohotkey
; スクリプト内の SC_LCTRL を変更
SC_CAPS := 0x3A      ; CapsLockキー
SC_RCTRL := 0xE01D   ; Right Ctrlキー
```

#### 2. 一時的な有効化機能
```autohotkey
; 緊急時の一時解除（例：F12キー2回押し）
F12::
F12::{
    ; 無効化を一時解除するロジック
}
```

#### 3. デバイス自動検出
現在のスクリプトはMSI固有です。他のメーカーの場合：
```autohotkey
; より汎用的なデバイス検出
if (InStr(deviceName, "ACPI") && InStr(deviceName, "Keyboard")) {
    ; ACPI内蔵キーボード全般を対象
}
```

## 📊 動作確認方法

### 1. 基本テスト
1. **メモ帳**（notepad.exe）を開く
2. 内蔵キーボードで以下をテスト:
   - 通常の文字キー → 正常動作するはず
   - Left Ctrl + C → Ctrlが無効化されているため、コピーされないはず
   - 外部キーボードのCtrl + C → 正常にコピーされるはず

### 2. 詳細テスト
1. **VS Code**で新しいファイルを作成
2. 内蔵キーボード：
   - Ctrl + S → 保存されないはず
   - Ctrl + Z → Undoされないはず
3. 外部キーボード：
   - Ctrl + S → 正常に保存されるはず
   - Ctrl + Z → 正常にUndoされるはず

## 🔄 スクリプトの管理

### 自動起動設定
1. **スタートアップフォルダ**を開く：
   - Win + R → `shell:startup` → Enter
2. `DisableLaptopLeftCtrl.ahk` のショートカットを作成
3. 再起動後、自動的にスクリプトが実行される

### スクリプト終了方法
1. **システムトレイ**のAutoHotkeyアイコンを右クリック
2. 「終了」を選択
3. または**タスクマネージャー**からプロセス終了

## 📞 サポート

### ログ確認
スクリプトはDebugViewでログを出力します：
- `OutputDebug("MSI内蔵キーボード Left Ctrl キー押された - ブロック済み")`
- `OutputDebug("MSI内蔵キーボード Left Ctrl キー離された - ブロック済み")`

### 問題報告時の情報
1. 使用中のWindows版（Win + R → `winver`）
2. AutoHotkey版（スクリプト実行時のメッセージ）
3. エラーメッセージの全文
4. 使用中のキーボードの型番（内蔵・外部）